var $event=$.event,$special,resizeTimeout,$nextObj,$prevObj;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(e,t){var i=this,a=arguments,s=function(){e.type="debouncedresize",$event.dispatch.apply(i,a)};resizeTimeout&&clearTimeout(resizeTimeout),t?s():resizeTimeout=setTimeout(s,$special.threshold)},threshold:250};var BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(e){function t(){var t=$(o),i=$(d);s&&(d.length?s.reject(r,t,i):s.resolve(r)),$.isFunction(e)&&e.call(a,r,t,i)}function i(e,i){e.src!==BLANK&&-1===$.inArray(e,l)&&(l.push(e),i?d.push(e):o.push(e),$.data(e,"imagesLoaded",{isBroken:i,src:e.src}),n&&s.notifyWith($(e),[i,r,$(o),$(d)]),r.length===l.length&&(setTimeout(t),r.unbind(".imagesLoaded")))}var a=this,s=$.isFunction($.Deferred)?$.Deferred():0,n=$.isFunction(s.notify),r=a.find("img").add(a.filter("img")),l=[],o=[],d=[];return $.isPlainObject(e)&&$.each(e,function(t,i){"callback"===t?e=i:s&&s[t](i)}),r.length?r.bind("load.imagesLoaded error.imagesLoaded",function(e){i(e.target,"error"===e.type)}).each(function(e,t){var a=t.src,s=$.data(t,"imagesLoaded");return s&&s.src===a?void i(t,s.isBroken):t.complete&&void 0!==t.naturalWidth?void i(t,0===t.naturalWidth||0===t.naturalHeight):void((t.readyState||t.complete)&&(t.src=BLANK,t.src=a))}):t(),s?s.promise(a):a},$(function(){$.elastic_grid={version:"1.0"},$.fn.elastic_grid=function(e){function t(e,t){e.each(function(e,i){classie.has(i,t)?(classie.toggle(i,"animate"),classie.remove(i,"hidden")):(classie.add(i,"hidden"),classie.remove(i,"animate"))})}function i(e){var t=e.toLowerCase().replace(" ","-");if(""!=e){{var i=$("<li>");$("<a>",{html:e,"data-filter":"."+t,href:"#","class":"filter"}).appendTo(i)}i.appendTo(m)}}function a(e){O.each(function(){var t=$(this);t.data("offsetTop",t.offset().top),e&&t.data("height",t.height())})}function s(){n(O),L.on("debouncedresize",function(){A=0,w=-1,a(),r();var e=$.data(this,"preview");"undefined"!=typeof e&&o()})}function n(e){e.on("click","span.og-close",function(){return o(),e.children().find("figure").css("top","100%"),!1}).children("a").on("click",function(){var e=$(this).parent();return e.removeClass("animate"),j===e.index()?o($(this)):l(e),!1})}function r(){C={width:L.width(),height:L.height()}}function l(e){o();var t=$.data(this,"preview"),i=e.data("offsetTop");if(A=0,"undefined"!=typeof t){if(w===i)return t.update(e),!1;i>w&&(A=t.height),o()}w=i,t=$.data(this,"preview",new d(e)),t.open()}function o(){O.find(".og-pointer").remove(),j=-1;var e=$.data(this,"preview");"undefined"==typeof e||e.close(),$.removeData(this,"preview")}function d(t){this.$item=t,this.expandedIdx=this.$item.index(),this.create(),this.update(),e.exOnClickEvent()}var h=Math.floor(6*Math.random()),c=["moveup","scaleup","fallperspective","fly","flip","helix","popup"];e.filterEffect="random"==e.filterEffect?c[h]:e.filterEffect,e=$.extend({},{items:null,filterEffect:"",hoverDirection:!0,hoverDelay:0,hoverInverse:!1,expandingHeight:500,expandingSpeed:300,exHideInfoBoxTitle:!1,exControls:!1,exControlsCSS:{position:"absolute",cursor:"pointer",padding:5,marginTop:"15%"},exControlsNextText:"Next",exControlsNextClass:null,exControlsPrevText:"Prev",exControlsPrevClass:null,exOnClickEvent:function(){},callback:function(){}},e);var p=$(this),f=e.items.length;if(0==f)return!1;p.html('<div class="wagwep-container"><nav id="porfolio-nav" class="clearfix"><ul id="portfolio-filter" class="nav nav-tabs clearfix"></ul></nav></div>');var g=$('<ul id="og-grid" class="og-grid"></ul>');for(itemIdx=0;itemIdx<f;itemIdx++)if(void 0!=e.items[itemIdx]){var u=e.items[itemIdx];liObject=$("<li></li>"),tags=u.tags,strTag="";for(var v=tags.length-1;v>=0;v--)strTag+=","+tags[v];strTag=strTag.substring(1),liObject.attr("data-tags",strTag),aObject=$("<a></a>"),aObject.attr("href","javascript:;;"),imgObject=$("<img/>"),imgObject.attr("src",u.thumbnail[0]),imgObject.attr("data-largesrc",u.large[0]),spanObject=$("<span></span>"),spanObject.html(u.title),figureObject=$("<figure></figure>"),figureObject.append(spanObject),imgObject.appendTo(aObject),figureObject.appendTo(aObject),aObject.appendTo(liObject),liObject.appendTo(g)}""==e.filterEffect&&(e.filterEffect="moveup"),g.addClass("effect-"+e.filterEffect),g.appendTo(p),1==e.hoverDirection&&g.find("li").each(function(){$(this).hoverdir({hoverDelay:e.hoverDelay,inverse:e.hoverInverse})});var m=p.find("#portfolio-filter"),x=g.find("li"),b={};numOfTag=0,x.each(function(e){var t=$(this),i=t.data("tags").split(",");t.attr("data-id",e),t.addClass("all"),$.each(i,function(e,i){i=$.trim(i),t.addClass(i.toLowerCase().replace(" ","-")),i in b||(b[i]=[],numOfTag++),b[i].push(t)})}),numOfTag>1?(i("All"),$.each(b,function(e){i(e)})):m.remove(),m.find("a").bind("click",function(){T.find("li.og-expanded").find("a").trigger("click"),T.find(".og-close").trigger("click"),$this=$(this),$this.css("outline","none"),m.find(".current").removeClass("current"),$this.parent().addClass("current");var e=$this.text().toLowerCase().replace(" ","-"),i=f;return g.find("li").each(function(a,s){classie.remove(s,"hidden"),classie.remove(s,"animate"),--i||setTimeout(function(){t(g.find("li"),e)},1)}),!1}),m.find("li:first").addClass("current");var C,T=g,O=T.children("li"),j=-1,w=-1,A=0,y=10,L=$(window),E=$("html, body"),P={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},k=P[Modernizr.prefixed("transition")],I=Modernizr.csstransitions,H={minHeight:e.expandingHeight,speed:e.expandingSpeed,easing:"ease"};d.prototype={create:function(){1==e.exControls&&(this.$itemNext=$("<span>"+e.exControlsNextText+"</span>"),this.$itemNext.css({right:0}),null!=e.exControlsCSS&&this.$itemNext.css(e.exControlsCSS),null!=e.exControlsNextClass&&this.$itemNext.addClass(e.exControlsNextClass),this.$itemNext.click(function(){var e=$(this).parent().parent().parent().parent().children();e.find("figure").css("top","100%");var t=$(this).parent().parent().parent(),i=t.data("tags"),a=t.index();if(e.removeClass("animate"),".all"==$("#portfolio-filter").find("li[class=current]").children().data("filter"))return void($(this).parent().parent().parent().next().length>0&&($nextObj=$(this).parent().parent().parent().next(),l($nextObj),setTimeout(function(){$("html,body").animate({scrollTop:$nextObj.offset().top},1e3)},1e3)));for(var s=[],n=0;n<e.length;n++)if(i.indexOf(",")>=0)for(var r=i.split(","),o=0;o<r.length;o++)e.eq(n).data("tags").indexOf(r[o])>=0&&$.inArray(n,s)<0&&s.push(n);else e.eq(n).data("tags").indexOf(i)>=0&&s.push(n);e.eq(s[$.inArray(a,s)+1]).length>0&&($nextObj=e.eq(s[$.inArray(a,s)+1]),l($nextObj),setTimeout(function(){$("html,body").animate({scrollTop:$nextObj.offset().top},1e3)},1e3))}),this.$itemPrev=$("<span>"+e.exControlsPrevText+"</span>"),this.$itemPrev.css({left:0}),null!=e.exControlsCSS&&this.$itemPrev.css(e.exControlsCSS),null!=e.exControlsPrevClass&&this.$itemPrev.addClass(e.exControlsPrevClass),this.$itemPrev.click(function(){var e=$(this).parent().parent().parent().parent().children();e.find("figure").css("top","100%");var t=$(this).parent().parent().parent(),i=t.data("tags"),a=t.index();if(e.removeClass("animate"),".all"==$("#portfolio-filter").find("li[class=current]").children().data("filter"))return void($(this).parent().parent().parent().prev().length>0&&($prevObj=$(this).parent().parent().parent().prev(),l($prevObj),setTimeout(function(){$("html,body").animate({scrollTop:$prevObj.offset().top},1e3)},1e3)));for(var s=[],n=0;n<e.length;n++)if(i.indexOf(",")>=0)for(var r=i.split(","),o=0;o<r.length;o++)e.eq(n).data("tags").indexOf(r[o])>=0&&$.inArray(n,s)<0&&s.push(n);else e.eq(n).data("tags").indexOf(i)>=0&&s.push(n);e.eq(s[$.inArray(a,s)-1]).length>0&&($prevObj=e.eq(s[$.inArray(a,s)-1]),l($prevObj),setTimeout(function(){$("html,body").animate({scrollTop:$prevObj.offset().top},1e3)},1e3))})),this.$title=$("<h3></h3>"),this.$description=$("<p></p>"),this.$href=$('<a href="#">Visit website</a>'),this.$detailButtonList=$('<span class="buttons-list"></span>'),this.$details=$('<div class="og-details"></div>').append(this.$title,this.$description,this.$detailButtonList),this.$loading=$('<div class="og-loading"></div>'),this.$fullimage=$('<div class="og-fullimg"></div>').append(this.$loading),this.$closePreview=$('<span class="og-close"></span>'),this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$itemNext,this.$itemPrev,this.$closePreview,this.$fullimage,this.$details),this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append($('<div class="og-pointer"></div>')),this.$item.append(this.getEl()),I&&this.setTransition()},update:function(t){if(t&&(this.$item=t),-1!==j){var i=O.eq(j);i.removeClass("og-expanded"),this.$item.addClass("og-expanded"),this.positionPreview()}if(j=this.$item.index(),"undefined"==typeof e.items[j]);else{if(eldata=e.items[j],0==e.exHideInfoBoxTitle&&this.$title.html(eldata.title),this.$description.html(eldata.description),this.$detailButtonList.html(""),urlList=eldata.button_list,urlList.length>0)for(v=0;v<urlList.length;v++){var a=$("<a></a>");a.addClass("link-button"),0==v&&a.addClass("first"),urlList[v].click&&a.attr("onclick",urlList[v].click),urlList[v].url&&a.attr("href",urlList[v].url),a.html(urlList[v].title),this.$detailButtonList.append(a)}var s=this;if("undefined"!=typeof s.$largeImg&&s.$largeImg.remove(),glarge=eldata.large,gthumbs=eldata.thumbnail,glarge.length==gthumbs.length&&glarge.length>0){var n=$("<ul></ul>");for(v=0;v<gthumbs.length;v++){var r=$("<li></li>"),a=$('<a href="javascript:;;"></a>'),l=$("<img/>");l.addClass("related_photo"),0==v&&l.addClass("selected"),l.attr("src",gthumbs[v]),l.attr("data-large",glarge[v]),a.append(l),r.append(a),n.append(r)}n.addClass("elastislide-list"),n.elastislide();var o=$('<div class="elastislide-wrapper elastislide-horizontal"></div>');o.append(n).find(".related_photo").bind("click",function(){o.find(".selected").removeClass("selected"),$(this).addClass("selected"),$largePhoto=$(this).data("large"),$(".og-fullimg").fadeOut(100,function(){$(this).fadeIn(500).html($largePhoto)})}),s.$details.prepend('<div class="infosep"></div>'),s.$details.prepend(o)}else s.$details.find(".infosep, .og-grid-small").remove();$(".og-fullimg").html(eldata.large[0])}},open:function(){setTimeout($.proxy(function(){this.setHeights(),this.positionPreview()},this),25)},close:function(){var e=this,t=function(){I&&$(this).off(k),e.$item.removeClass("og-expanded"),e.$previewEl.remove()};return setTimeout($.proxy(function(){"undefined"!=typeof this.$largeImg&&this.$largeImg.fadeOut("fast"),this.$previewEl.css("height",0);var e=O.eq(this.expandedIdx);e.css("height",e.data("height")).on(k,t),I||t.call()},this),25),!1},calcHeight:function(){var e=C.height-this.$item.data("height")-y,t=C.height;e<H.minHeight&&(e=H.minHeight,t=H.minHeight+this.$item.data("height")+y),this.height=e,this.itemHeight=t},setHeights:function(){var e=this,t=function(){I&&e.$item.off(k),e.$item.addClass("og-expanded")};this.calcHeight(),this.$previewEl.css("height",this.height),this.$item.css("height",this.itemHeight).on(k,t),I||t.call()},positionPreview:function(){var e=this.$item.data("offsetTop"),t=this.$previewEl.offset().top-A,i=this.height+this.$item.data("height")+y<=C.height?e:this.height<C.height?t-(C.height-this.height):t;E.animate({scrollTop:i},H.speed)},setTransition:function(){this.$previewEl.css("transition","height "+H.speed+"ms "+H.easing),this.$item.css("transition","height "+H.speed+"ms "+H.easing)},getEl:function(){return this.$previewEl}},T.imagesLoaded(function(){a(!0),r(),s()})}});